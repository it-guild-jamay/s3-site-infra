name: GitHub Actions Demo
on: 
  push:
    branches:
      - "main"

jobs:
  Deploy-Backend-API-Gateway:
    runs-on: ubuntu-latest
    steps:
    
      - name: Here goes the job
        run: echo "Job"

      - name: Check out repository code
        uses: actions/checkout@v2
        with:
          repository: ''

  Deploy-S3-Website:
    runs-on: ubuntu-latest
    steps:
      - name: Initial Facts
        run: |
          echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
          echo "üîé Automatically depoying your branch ${{ github.ref }}\
          üêß from a ${{ runner.os }} server hosted by GitHub!"
      
      - name: Check out repository code
        uses: actions/checkout@v2
      
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."

      - name: Frontent - terraform init
        run: |
          cd frontend/
          terraform init -input=false
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          BACKEND_BUCKET: ${{ secrets.BACKEND_BUCKET }}
          REGION: ${{ secrets.AWS_REGION }}
      
      - name: Terraform Plan
        run: |
          terraform plan
          terraform validate
          terraform apply --auto-approve
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          BACKEND_BUCKET: ${{ secrets.BACKEND_BUCKET }}
          REGION: ${{ secrets.AWS_REGION }}
          TF_VAR_site_bucket_name: ${{ secrets.WEBSITE_BUCKET_NAME}}
